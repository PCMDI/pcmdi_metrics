os:
  - linux
  - osx

language: c++

before_install:
    - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get update -qq; sudo apt-get install -y gfortran; fi
    - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install -y cmake; fi
#    - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install --reinstall python2.7; fi
    - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew update ; brew outdated cmake || brew upgrade cmake ; fi
#    - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew outdated python || brew upgrade python ; fi
    - if [ "$TRAVIS_OS_NAME" = "osx" ]; then ./upgradePython.sh ; fi
    - cmake --version
    - python --version
    - ls -al /usr/lib/python2.7/lib-dynload/pyexpat.so
    - ( echo "import pyexpat" ; echo "print pyexpat.EXPAT_VERSION" ) | python
    - ( echo "import sys" ; echo "print sys.executable" ) | python

script:
    - cd ..
    - mkdir _build
    - cd _build
    - cp ../pcmdi_metrics/install_metrics.bash .
    - bash ./install_metrics.bash
    - source ./PCMDI_METRICS/bin/setup_runtime.sh
    - cd ./PCMDI_METRICS/tmp/metrics
    - python test/test_suite.py
